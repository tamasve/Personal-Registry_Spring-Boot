<!doctype html>
<html layout:decorate="~{layouts/main}">

<head>
    <link rel="stylesheet" href="../static/css/main.css" th:href="@{/css/main.css}">
</head>

<body>

        <section class="report" layout:fragment="content">

            <section class="title">
                <h2>Person data</h2>
            </section>

            <section class="container">

              <section class="data">

                <article class="person-data underline">

                    <p class="align-right">Vezet√©kn√©v:</p>
                    <p th:text="${person.lastName}">Kov√°cs</p>
                    <p class="align-right">Keresztn√©v:</p>
                    <p th:text="${person.firstName}">P√©ter</p>
                    <p class="align-right">Szem√©lyi azonos√≠t√≥:</p>
                    <p>
                        <form action="#"  id="cardForm" th:action="@{/persons/select/}">
                            <select id="selectIdCard" name="selectIdCard">
                                <option th:each="pers : ${persons}"
                                                    th:text="${pers.idCard}"
                                                    th:value="${pers.id}"
                                                    th:selected="${pers.idCard == person.idCard} ?: 'selected'  ">673456KL</option>
                            </select>
                            <button type="submit" class="formButton">Select other person</button>
                        </form>
                    </p>


                </article>

                <article class="persons-table">
                    <section class="header grid-address">
                        <div class="header-cell"></div>
                        <div class="header-cell">C√≠m t√≠pusa</div>
                        <div class="header-cell">Ir√°ny√≠t√≥sz√°m</div>
                        <div class="header-cell">V√°ros</div>
                        <div class="header-cell">K√∂zter√ºlet</div>
                        <div class="header-cell">H√°zsz√°m</div>
                    </section>

                    <!-- 1 row for adding a new address =a FORM with 1 address object -->
<!--                    <form th:if="${newRow}" class="new-row" th:action="@{/addresses/add}" method="post" th:object="${obj}">-->
<!--                        <div>Ô∏è<button type="submit">‚ûï</button></div>-->
<!--                        <div><input type="text" name="postalCode" th:field="*{postalCode}" /></div>-->
<!--                        <div><input type="text" name="city" th:field="*{city}" /></div>-->
<!--                        <div><input type="text" name="place" th:field="*{place}" /></div>-->
<!--                        <div><input type="text" name="number" th:field="*{number}" /></div>-->
<!--                    </form>-->

                    <!-- A row for each apartment object -->
                    <section th:each="address : ${person.addresses}">

                        <section class="row grid-address">
                            <div><a th:href="@{/addresses/delete/{id}(id=${address.id})}">üóëÔ∏è</a></div>
                            <div th:text="${address.addressType.value}">√Ålland√≥</div>
                            <div th:text="${address.postalCode}">1135</div>
                            <div th:text="${address.city}">Budapest</div>
                            <div th:text="${address.place}">V√°ci √∫t</div>
                            <div th:text="${address.number}">72</div>
                        </section>

                        <section th:each="contact, status : ${address.contacts}" class="grid-contact">
                            <div th:text="${status.first} ? 'El√©rhet≈ës√©gek' : ''" class="contact-text"></div>
                            <div th:text="${contact.contactType.value} +':'" class="header-cell">Phone:</div>
                            <div th:text="${contact.value}" class="row grid-contact-value">+36-30-6566464</div>
                        </section>

                    </section>

                </article>

              </section>
            </section>

<!--            This small JS code is needed so that we can gain the selected value of the option select - it changes action link -->
            <script type="text/javascript">
                console.log("JS run...");
                var e = document.getElementById('selectIdCard');
                e.addEventListener("change", setFormAction);
                setFormAction();

                function setFormAction() {
                    var frm = document.getElementById('cardForm');
                    if (frm) {
                        console.log("form found...");
                        var e = document.getElementById('selectIdCard');
                        var text = e.options[e.selectedIndex].text;
                        console.log(text);
                        frm.action = '/persons/select/' + text;
                    }
                }
            </script>

        </section>

</body>

</html>